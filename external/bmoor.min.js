/*! bmoor 2014-06-29 */
!function(a,b){"use strict";function c(a){return a?x(a)?a.split("."):D(a)?a.slice(0):a:[]}function d(b,d,e){var f,g,h,i=e||a;if(b&&(x(b)||C(b))){b=c(b),g=b.pop();for(var j=0;j<b.length;j++)h=b[j],i[h]||(i[h]={}),i=i[h];f=i[g],i[g]=d}return f}function e(b,d){var e,f,g,h=d||a;if(b&&(x(b)||C(b))){b=c(b),f=b.pop();for(var i=0;i<b.length;i++)g=b[i],h[g]||(h[g]={}),h=h[g];e=h[f],delete h[f]}return e}function f(b,d){var e,f=d||a;if(b&&(x(b)||C(b))){b=c(b);for(var g=0;g<b.length;g++)e=b[g],f[e]||(f[e]={}),f=f[e];return f}if(A(b))return b;throw"unsupported type"}function g(d,e){var f=e||a;if(x(d)||C(d)){d=c(d);for(var g=0;g<d.length;g++){var h=d[g];if(!f[h])return b;f=f[h]}return f}if(A(d))return d;throw"unsupported type"}function h(a,b){var c,d,e;if(C(b)){for(c=0,d=b.length;d>c&&!e;c++)e=g(a,b[c]);return e}return g(a,b)}function i(a,b,c){var d;c?(c.$aliases||(c.$aliases={}),d=c.$aliases):d=db,d[a]=b}function j(a,b){var c;return b?(b.$aliases||(b.$aliases={}),c=b.$aliases):c=db,c[a]}function k(a,b){d(a,b,bb)}function l(a,c){var d;return c===b&&(d=j(D(a)?a.join("."):a))?d:h(a,c)}function m(a,b){d(a,b),i(a,b)}function n(a,b){var c,d,e;if(e="return new obj(",arguments.length>1)for(c=0,d=b.length;d>c;c++)c&&(e+=","),e+="args["+c+"]";return e+=")",new Function("obj","args",e)(a,b)}function o(a,b){return 1===arguments.length&&(b=a,a={}),K(b,function(b,c){d(c,b,a)}),a}function p(a){return Object.prototype.toString.call(a)}function q(a){var b=function(){};return b.prototype=a,n(b)}function r(a){return I(arguments,function(b){b!==a&&J(b,function(b,c){a[c]=b})}),a}function s(a,b,c){if(a===b)return b;if(b)if(b.copy)b.copy(a,c);else if(C(a)){b.length=0;for(var d=0,e=a.length;e>d;d++)b.push(s(a[d]))}else J(b,function(a,c){delete b[c]}),J(a,function(a,c){b[c]=a});else b=a,a&&(b=a.clone?a.clone():C(a)?s(a,[],c):s(a,{},c));return b}function t(a,c){var d,e,f,g=typeof a,h=typeof c;if(a===c)return!0;if(a!==a&&c!==c)return!0;if(null===a||a===b||null===c||null===c)return!1;if(a.equals)return a.equals(c);if(c.equals)return c.equals(a);if(g===h&&"object"===g)if(C(a)){if(!C(c))return!1;if((d=a.length)===c.length){for(e=0;d>e;e++)if(!t(a[e],c[e]))return!1;return!0}}else if(!C(c)){f={};for(e in a)if(a.hasOwnProperty(e)){if(!t(a[e],c[e]))return!1;f[e]=!0}for(e in c)if(c.hasOwnProperty(e)&&!f&&c[e]!==b)return!1}return!1}function u(a){A(a)&&a.stack?(console.warn(a),console.debug(a.stack)):(console.warn(a),console.trace())}function v(a){return a===b}function w(a){return a!==b}function x(a){return"string"==typeof a}function y(a){return"number"==typeof a}function z(a){return"function"==typeof a}function A(a){return a&&"object"==typeof a}function B(a){return"boolean"==typeof a}function C(a){return 1==(a&&"number"==typeof a.length)}function D(a){return 1==(a&&"[object Array]"===p(a))}function E(a){return"function"==typeof a&&a.$isQuark}function F(a){var b;if(!A(a))return C(a)?0===a.length:v(a);for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function G(a){return A(a)&&a.then!==b}function H(a){return D(a)&&z(a[a.length-1])}function I(a,b,c){var d,e;for(c||(c=a),d=0,e=a.length;e>d;++d)d in a&&b.call(c,a[d],d,a)}function J(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function K(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&"_"!==d.charAt(0)&&"prototype"!==d&&"length"!==d&&"name"!==d&&b.call(c,a[d],d,a)}function L(a,b,c){a&&(a.forEach&&a.forEach!==L?a.forEach(b,c):C(a)?I(a,b,c):z(a)?K(a,b,c):J(a,b,c))}function M(a){var b;return E(a)?a.$promise:(b=new $,b.resolve(a),b.promise)}function N(b,e){var f,g=c(b),i=h(g),j=function(){};return E(i)?i:(e=e||a,j.$isQuark=!0,$&&(f=new $,j.$promise=f.promise,j.$ready=function(a){f.resolve&&f.resolve(a),g&&d(g,a,e)}),d(g,j,e),j)}function O(a,b){var c=h(a,b);return c?M(c):N(a,b).$promise}function P(a,b){var c=[];return I(a,function(a,d){if(x(a))switch(a.charAt(0)){case"@":c[d]=j(a.substr(1),b);break;case"-":c[d]=h(a.substr(1),b);break;case"+":a=a.substr(1);default:c[d]=O(a,b)}else c[d]=a}),c}function Q(a,b,c){var d;return x(a)?O(a,c):C(a)?(d=new _,I(a,function(e,f){b&&x(e)&&(e=O(e,c)),G(e)?(e.then(function(b){a[f]=b}),d.add(e)):a[f]=e}),d.run(),d.promise.then(function(){return a})):void 0}function R(a,b,c){var d;if(z(a))d=a,a=[];else{if(!H(a))throw"inject needs arr to be either Injectable or Function";d=a[a.length-1]}return Q(P(a,b),!1,b).then(function(a){return d.apply(c,a)})}function S(a){var b=a,c=document.createElement("a");return ab&&(c.setAttribute("href",b),b=c.href),c.setAttribute("href",b),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:"/"===c.pathname.charAt(0)?c.pathname:"/"+c.pathname}}function T(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function U(a,b,c){if(a.indexOf)return a.indexOf(b,c);var d=a.length>>>0;for(c=+c||0,1/0===Math.abs(c)&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1}function V(a,b,c){var d=U(a,b,c);return d>-1?[a.splice(d,1)]:[]}function W(a,b,c){var d,e,f=U(a,b,c);return f>-1?(e=a.splice(f,1),d=W(a,b,f),d.unshift(e),d):[]}function X(a,b,c){if(a.filter)return a.filter(b,c);var d,e,f=Object(this),g=f.length>>>0,h=[];if("function"!=typeof b)throw"func needs to be a function";for(d=0;g>d;d++)d in f&&(e=f[d],b.call(c,e,d,f)&&h.push(e));return h}function Y(a,b,c){var d,e=[],f=[],g=[],h=[];for(a=a.slice(0),b=b.slice(0),a.sort(c),b.sort(c);a.length>0&&b.length>0;)d=c(a[0],b[0]),0>d?e.push(a.shift()):d>0?f.push(b.shift()):(g.push(a.shift()),h.push(b.shift()));for(;a.length;)e.push(a.shift());for(;b.length;)f.push(b.shift());return{left:e,intersection:{left:g,right:h},right:f}}function Z(a){this.defer=a}function $(a){this.handler=a||this.defaultHandler,this.callbacks=[],this.value=null,this.promise=new Z(this)}function _(){this.count=0,this.loaded=!1,this.errors=[],this.defer=new $,this.promise=this.defer.promise}var ab,$,Z,_,bb=a.bMoor||{},cb=a.bmoor||{},db={};ab=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10),isNaN(ab)&&(ab=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10)),i("global",a),i("undefined",b),d("bMoor",bb),d("bmoor",cb),d("bmoor.defer.Promise",Z),r(Z.prototype,{then:function(a,b){var c,d,e=this,f=this.defer,g=this.sub=this.defer.sub();return c=function(b){try{g.resolve((a||f.defaultSuccess)(b)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},d=function(a){try{g.resolve((b||f.defaultFailure)(a)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},f.register(c,d),g.promise},"catch":function(a){return this.then(null,a)},reject:function(a){if(!this.sub)throw"must reject from inside a then";this.sub.reject(a)},done:function(a){return this.then(a),this},fail:function(a){return this.then(null,a),this},"finally":function(a){function b(a,b){var c=cb.defer.Basic();return b?c.resolve(a):c.reject(a),c.promise}function c(c,d){var e=null;try{e=(a||dis.defaultSuccess)()}catch(f){return b(f,!1)}return e&&bb.isFunction(e.then)?e.then(function(){return b(c,d)},function(a){return b(a,!1)}):b(c,d)}return this.then(function(a){return c(a,!0)},function(a){return c(a,!1)})},always:function(a){return this["finally"](a),this}}),d("bmoor.defer.Basic",$),function(){function a(a){return a&&a.then?a:{then:function(c){bb.isArrayLike(a)&&a.$inject?c.apply(b,a):c(a)}}}function c(a){return{then:function(b,c){c(a)}}}r($.prototype,{defaultHandler:function(a){bb.error.report(a)},defaultSuccess:function(a){return a},defaultFailure:function(a){throw a},register:function(a,b){this.value?this.value.then(a,b):this.callbacks.push([a,b])},resolve:function(b){var c,d,e,f;if(this.callbacks)for(c=this.callbacks,this.callbacks=null,this.value=a(b),e=0,f=c.length;f>e;e++)d=c[e],this.value.then(d[0],d[1])},reject:function(a){this.resolve(c(a))},sub:function(){return new cb.defer.Basic(this.handler)}})}(),d("bmoor.defer.Group",_),function(){function a(){0===this.count&&this.loaded&&(this.errors.length?this.defer.reject(this.errors):this.defer.resolve(!0))}function b(){this.count--,a.call(this)}r(_.prototype,{add:function(a){var c=this;this.count++,a.then(function(){b.call(c)},function(a){c.errors.push(a),b.call(c)})},run:function(){this.loaded=!0,a.call(this)}})}(),d("bmoor.defer.all",function(){var a,b=new _;return a=y(arguments[0].length)?arguments[0]:arguments,bb.forEach(a,function(a){b.add(a)}),b.run(),b.promise}),r(bb,{parseNS:c,dwrap:M,set:d,get:f,del:e,exists:h,register:i,check:j,find:l,install:m,makeQuark:N,ensure:O,request:Q,translate:P,inject:R,plugin:k,loop:I,each:J,iterate:K,forEach:L,isBoolean:B,isDefined:w,isUndefined:v,isArray:D,isArrayLike:C,isObject:A,isFunction:z,isNumber:y,isString:x,isInjectable:H,isEmpty:F,isQuark:E,instantiate:n,map:o,object:{mask:q,extend:r,copy:s,equals:t},string:{trim:T},array:{compare:Y,indexOf:U,remove:V,removeAll:W,filter:X},error:{report:u},url:{resolve:S}})}(this),bMoor.inject(["bmoor.defer.Basic","@global",function(a,b){function c(b,c,d){var e,f=b.name,g=b.namespace,h=new a,i=h.promise;if(bMoor.isObject(d))return e=d.abstract?function(){throw g+" is abstracted, either extend or use only static members"}:d.construct?d.construct:function(){},d.id=f,d.name=g.pop(),d.mount=bMoor.get(g),d.namespace=g,d.whenDefined=c.$promise,this.clean||(this.preProcess.sort(function(a,b){return b.rank-a.rank}),this.postProcess.sort(function(a,b){return b.rank-a.rank}),this.clean=!0),h.resolve(),bMoor.loop(this.preProcess,function(a){i=i.then(function(){return bMoor.inject(a.module,d,e)})}),i.then(function(){return e.$onMake&&e.$onMake(d),e});throw"Constructor has no idea how to handle as definition of "+d}var d,e=bMoor.makeQuark("bmoor.build.Compiler"),f=function(){this.preProcess=[],this.postProcess=[],this.clean=!0},g={};f.prototype.addModule=function(a,b,c){a=parseInt(a,10),this.clean=!1,arguments.length<3?c=b:bMoor.install(b,c[c.length-1]),a>=0?this.preProcess.push({rank:a,module:c}):this.postProcess.push({rank:a,module:c})},f.prototype.make=function(b,d,e){var f,h,i=this,j=function(d){c.call(i,{name:b,namespace:f},h,d).then(function(b){var c=new a,e=c.promise;return c.resolve(),bMoor.loop(i.postProcess,function(a){e=e.then(function(){return bMoor.inject(a.module,d,b)})}),e.then(function(){return h.$ready(b),b})})};if(bMoor.isString(b))f=bMoor.parseNS(b);else{if(!bMoor.isArray(b))throw JSON.stringify(b)+" > "+JSON.stringify(d)+" > message : you need to define a name and needs to be either a string or an array";f=b,b=b.join(".")}return h=bMoor.makeQuark(f,e),bMoor.isInjectable(d)||!function(){var a=d;d=[function(){return a}]}(),g[b]=d,bMoor.require?bMoor.require.inject(d,e).then(j):bMoor.inject(d,e).then(j),h.$promise},f.prototype.mock=function(d,e,f){var h=this,i=new a,j={$promise:i.promise};return f||(f=b),bMoor.inject(g[d],bMoor.object.extend({},f,e)).then(function(b){return c.call(h,{name:"mock",namespace:["mock"]},j,b).then(function(c){var d=new a,e=d.promise;return d.resolve(),bMoor.loop(h.postProcess,function(a){e=e.then(function(){return bMoor.inject(a.module,b,c)})}),e.then(function(){return i.resolve(j),c})})})},f.prototype.define=function(a,b,c){var d=bMoor.makeQuark(a,c);return bMoor.isInjectable(b)?bMoor.inject(b).then(function(a){d.$ready(a)}):d.$ready(b),d.$promise},d=new f,f.$instance=d,bMoor.install("bmoor.build.$compiler",d),bMoor.plugin("make",function(a,b){return d.make(a,b)}),bMoor.plugin("mock",function(a,b){return d.mock(a,bMoor.map(b))}),bMoor.plugin("define",function(a,b){return d.define(a,b)}),e.$ready(f)}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(9,"bmoor.build.ModDecorate",["-decorators",function(a){var b=this.prototype;if(a){if(!bMoor.isArray(a))throw"the decoration list must be an array";bMoor.loop(a,function(a){a.$wrap&&a.$wrap(b)})}}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(5,"bmoor.build.ModFactory",["-factory",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b["$"+c]=function(){return a.apply(b,arguments)}})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(1,"bmoor.build.ModFinalize",["-onMake","-parent",function(a,b){a?this.$onMake=a:b&&(this.$onMake=b.$onMake)}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(90,"bmoor.build.ModInherit",["-id","-namespace","-name","-mount","-parent",function(a,b,c,d,e){var f,g=this;e&&(f=function(){this.constructor=g},f.prototype=e.prototype,this.prototype=new f),this.prototype.$static=g,this.prototype.__class=a,this.prototype.__namespace=b,this.prototype.__name=c,this.prototype.__mount=d}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(8,"bmoor.build.ModMixins",["-mixins",function(a){a&&(a=bMoor.isArray(a)?a.splice(0):[a],a.unshift(this.prototype),bMoor.object.extend.apply(this,a))}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(-2,"bmoor.build.ModPlugin",["-plugins",function(a){var b=this;a&&bMoor.loop(a,function(a){var c;c=a.instance?bMoor.isString(a.instance)?b["$"+a.instance]:bMoor.instantiate(b,a.instance):b,bMoor.iterate(a.funcs,function(a,d){bMoor.isString(a)&&(a=b[a]),bMoor.plugin(d,function(){return a.apply(c,arguments)})})})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(10,"bmoor.build.ModProperties",["-properties",function(a){var b;for(b in a)this.prototype[b]=a[b]}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(0,"bmoor.build.ModRegister",["-id",function(a){bMoor.register(a,this)}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(-1,"bmoor.build.ModSingleton",["-singleton",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b["$"+c]=bMoor.instantiate(b,a)})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){a.$instance.addModule(10,"bmoor.build.ModStatics",["-statics",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b[c]=a})}])}]),function(){function a(a,b){return this.promise.then(function(){return a.apply({},b||[])})}bMoor.make("bmoor.defer.Stack",{construct:function(){this.promise=null},properties:{getPromise:function(){return this.promise},isStacked:function(){return null!==this.promise},begin:function(){this.promise=null},run:function(a){this.promise?this.promise["finally"](a):a()},add:function(b,c){return this.promise?this.promise=a.call(this,[b,c]):(this.promise=b.apply({},c),this.promise.then||(this.promise=null)),this.promise}}})}(),function(){bMoor.make("bmoor.comm.Connector",{properties:{request:function(a,b){return new bmoor.comm[a](b).promise},http:function(a){return this.request("Http",a)},get:function(a,b){return bMoor.isString(a)&&(a={url:a}),b&&(a.data=b),a.method="GET",this.http(a)},post:function(a,b){return bMoor.isString(a)&&(a={url:a}),b&&(a.data=b),a.method="POST",this.http(a)},script:function(a){return bMoor.isObject(a)&&(a=a.url||a.src),this.request("Script",a)},style:function(a){return bMoor.isObject(a)&&(a=a.url||a.src),this.request("Style",a)},image:function(a){var b=new bmoor.defer.Basic,c=new Image;return"#"==a[0]&&(a=$(a)[0].src),c.onload=function(){b.resolve({data:c,valid:!0,status:200,headers:void 0})},c.src=a,b.promise}}})}(),function(){var a=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}throw"error"};bMoor.make("bmoor.comm.Http",{construct:function(a){var b=this,c=this.makeXHR(a.method.toUpperCase(),a.url,void 0===a.async?!0:a.async,a.user,a.password);c.onreadystatechange=function(){4==c.readyState&&(-2!==b.status&&(b.status=c.status),b.resolve(c.responseType?c.response:c.responseText,c.getAllResponseHeaders()))},bMoor.forEach(a.headers,function(a,b){c.setRequestHeader(b,a)}),a.mimeType&&c.overrideMimeType(a.mimeType),a.responseType&&(c.responseType=a.responseType),this.url=bMoor.url.resolve(a.url),this.status=null,this.connection=c,this.$defer=new bmoor.defer.Basic,this.promise=this.$defer.promise,c.send(a.data||null)},properties:{makeXHR:function(b,c,d,e,f){var g=new a;return"withCredentials"in g||(g="undefined"!=typeof XDomainRequest?new XDomainRequest:null),g.open(b,c,d,e,f),g},abort:function(){null===this.status&&(this.status=-2,this.connection&&this.connection.abort())},resolve:function(a,b){var c,d,e=this.status,f=e>=200&&300>e,g=this.url.protocol;this.connection=null,e="file"==g&&0===e?a?200:404:e,e=1223==e?204:e,d=f?"resolve":"reject",c=[a,e,b],c.$inject=!0,this.$defer[d](c)}},plugins:[{funcs:{$http:function(a){var b=this;return b=new b(a),b.promise}}}]})}(),function(a,b){"use strict";a.make("bmoor.comm.Registry",{singleton:{instance:[]},construct:function(){var b,c,d;a.root||(b=document.getElementsByTagName("script"),c=b[b.length-1],c.hasAttribute("root")?a.root=c.getAttribute("root"):(d=c.getAttribute("src").match(/^(.*)\/b[Mm]oor(\.min)?\.js/),d?a.root=d[1]:(d=c.getAttribute("src").match(/^(.*)\/(js|src|scripts)/),a.root=d?d[0]:""))),this.reset(a.root)},plugins:[{instance:"instance",funcs:{"ns.locate":function(a){return this.locate(a)},"ns.register":function(a,b,c,d){return this.set(a,b,c,d)}}}],properties:{libRoots:{},parseResource:function(a){var b=a.match(/^(.*)\/(js|src)/);return b?b[1]:null},reset:function(a){this.libRoots={},this.setRoot(a)},setRoot:function(a){this.libRoots["."]={fullName:!1},this.libRoots["/"]=a,this.libRoots[">"]=this.parseResource(a),this.libRoots.jquery={"/":a+"/jquery",".":{fullName:!0}}},set:function(c,d,e,f){var g=this.libRoots,h=a.parseNS(c);for(e||(e={});h.length;){var i=h.shift();g[i]===b&&(g[i]={}),g=g[i]}g["/"]=d,g["."]=e,g["*"]=f===!0,g[">"]=this.parseResource(d)},del:function(b){for(var c=this.libRoots,d=null,e=null,f=a.parseNS(b);f.length&&c;){var g=f.shift();c[g]?(d=c,e=g,c=c[e]):c=null}c&&delete d[e]},get:function(b,c){for(var d=this.libRoots,e=this.libRoots,f=a.parseNS(b),g=c?null:f.pop(),h=f.slice(0);f.length;){var i=f[0];if(!d[i])break;d=d[f.shift()],d["/"]&&(e=d,h=f.slice(0))}return{root:e["/"],path:e["*"]?[]:h,name:g,settings:e["."],resource:e[">"]}},locate:function(a){var b=this.get(a);return b.root+(b.path.length?"/"+b.path.join("/"):"")+"/"+(b.settings.fullName?a:b.name)}}})}(bMoor),bMoor.make("bmoor.comm.Require",["bmoor.comm.Script","bmoor.defer.Group",function(a,b){return{construct:function(){},properties:{forceSync:!1,translate:function(a,c){var d,e,f=new b;for(d in a)e=a[d],">"===e.charAt(0)&&(e=e.substr(1).split(">"),a[d]="-"+e[0],f.add(this.get(e[0],!0,e[1])));return f.run(),f.promise.then(function(){return bMoor.translate(a,c)})},inject:function(a,b,c){var d;if(bMoor.isFunction(a))d=a,a=[];else{if(!bMoor.isArray(a))throw console.trace(),"inject needs arr to be either Array or Function";a=a.slice(0),d=a.pop()}return this.translate.call(this,a,b).then(function(a){return bMoor.request(a,!1,b).then(function(){return d.apply(c,a)})})},get:function(b,c,d){var e,f;return f=bMoor.exists(b),void 0===f?(e=bMoor.ensure(b),new a(d||bMoor.ns.locate(b)+".js",this.forceSync?!1:c).promise.then(function(){e.$ready(bMoor.exists(b))}),e.$promise):bMoor.isQuark(f)?f.$promise:bMoor.dwrap(f)},hash:function(a){var b,c=bmoor.defer.Group();for(b in a)c.add(this.get(b,!0,a[b]));c.run()},list:function(a){var b,c,d=bmoor.defer.Group();for(b=0,c=a.length;c>b;b++)d.add(this.get(a[b]));d.run()}},plugins:[{instance:[],funcs:{require:function(a,b){var c;return this.forceSync=!0,c=this.get(a,b),this.forceSync=!1,c},"require.translate":function(a,b){return this.translate(a,b)},"require.inject":function(a,b,c){return this.inject(a,b,c)}}}]}}]),function(a){"use strict";bMoor.make("bmoor.comm.Resource",{construct:function(a,b){var c=this;this.$defer=new bmoor.defer.Basic,this.promise=this.$defer.promise,new bmoor.comm.Http({method:"GET",url:a,async:b}).promise.then(function(a){try{c.status=200,c.success(c.apply(a))}catch(b){c.status=17003,c.failure(b)}},function(a,b){c.status=b,c.failure(a)})},properties:{apply:function(a){return a},success:function(a){this.status=this.status||200,this.resolve(a)},failure:function(a){this.status=this.status||19129,this.resolve(a)},resolve:function(b){200===this.status?this.$defer.resolve({data:b,status:this.status,headers:a}):this.$defer.reject({data:b,status:this.status,headers:a})}}})}(),bMoor.make("bmoor.comm.Script",["bmoor.comm.Resource",function(a){return{parent:a,construct:function(){a.apply(this,arguments)},properties:{apply:function(a){var b=document.createElement("script");b.text=a,document.body.appendChild(b)}}}}]),bMoor.make("bmoor.comm.Style",["bmoor.comm.Resource",function(a){return{parent:a,construct:function(){a.apply(this,arguments)},properties:{apply:function(a){var b=document.createElement("style");b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),document.body.appendChild(b)}}}}]),bMoor.make("bmoor.core.Collection",["bmoor.core.Model",function(a){return{parent:Array,traits:[a],construct:function(a){this.merge(this.inflate(a))},properties:{simplify:function(){return this.deflate().slice(0)}}}}]),bMoor.make("bmoor.core.CollectionObserver",["bmoor.core.MapObserver",function(a){return{parent:a,construct:function(){a.apply(this,arguments)},properties:{observe:function(b){var c=this;this.removals=[],this.watches=[],this.changes={moves:[],removals:[]},b.pop=function(){var a=Array.prototype.pop.call(this);return void 0===a.$markRemoval&&(a.$markRemoval=c.removals.length),c.removals.push(a),a},b.shift=function(){var a=Array.prototype.shift.call(this);return void 0===a.$markRemoval&&(a.$markRemoval=c.removals.length),c.removals.push(a),a},b.splice=function(){var a,b,d=Array.prototype.splice.apply(this,arguments);for(a=0,b=d.length;b>a;a++)void 0===d[a].$markRemoval&&(d[a].$markRemoval=c.removals.length+a);return c.removals=c.removals.concat(d),d},a.prototype.observe.call(this,b)},watchChanges:function(a){this.watches.push(a)},check:function(){var b=this;this.checking||(a.prototype.check.call(this),this.checking=!0,this.changes=this.checkChanges(),this._needNotify(this.changes)&&bMoor.loop(this.watches,function(a){a(b.changes)}),this.checking=!1)},checkChanges:function(){var a,b,c,d=this.model,e={},f=(this.cleaned,{});for(c in d)if(d.hasOwnProperty(c)&&"_"!==c[0]){if(b=d[c],"function"==typeof b)continue;a=parseInt(c,10),isNaN(a)||(b._co||(b._co={}),b.$remove?this.model.splice(a,1):void 0===b._co.index?f[c]=b:b._co.index!=a&&(f[c]=b,void 0!==b.$markRemoval&&(this.removals[b.$markRemoval]=void 0,delete b.$markRemoval)),b._co.index=a)}return e.removals=this.removals,e.moves=f,this.removals=[],e},_needNotify:function(a){var b;for(b in a)if(a.hasOwnProperty(b))if("removals"==b){if(a.removals.length)return!0}else{if("moves"!=b)return!0;if(!bMoor.isEmpty(a.moves))return!0}return!1}}}}]),bMoor.make("bmoor.core.Decorator",[function(){function a(a,b,c){var d=typeof c,e=b[a];"function"==d?b[a]=function(){var a,b=this._wrapped;return this.$wrapped=e,a=c.apply(this,arguments),this.$wrapped=b,a}:"string"==d&&(b[a]+=" "+c)}return{construct:function(){},onMake:function(){var b=this,c=new b;b.$wrap=function(b){var d;for(d in c)"_construct"!==d&&(b[d]?a(d,b,c[d]):b[d]=c[d])}}}}]),bMoor.make("bmoor.core.Interval",{singleton:{instance:[]},construct:function(){this._c=0,this.timeouts={},this.hash={}},properties:{set:function(a,b){var c,d=this.timeouts[b],e=this._c++;return d||(d=this.timeouts[b]={_c:0},bMoor.testMode||(d._hk=setInterval(function(){bMoor.iterate(d,function(a){a()})},b))),c=d._c++,d[c]=a,this.hash[e]={hk:d._c,val:b},e},flush:function(){bMoor.iterate(this.timeouts,function(a){bMoor.iterate(a,function(a){a()})})},clear:function(a){var b=this.hash[a];b&&(delete this.timeouts[b.val][b.hk],delete this.hash[a])}},plugins:[{instance:"instance",funcs:{setInterval:"set",clearInterval:"clear"}}]}),bMoor.make("bmoor.core.Map",["bmoor.core.Model",function(a){return{traits:[a],construct:function(a){this._merge(this._inflate(a))},properties:{_simplify:function(){var a,b={},c=this.deflate();for(a in c)c.hasOwnProperty(a)&&"$"!==a.charAt(0)&&(b[a]=c[a]);return b},toJson:function(){return JSON.stringify(this._simplify())}}}}]),bMoor.make("bmoor.core.MapObserver",["bmoor.core.Interval",function(a){var b=0,c={};return{construct:function(d){0===b&&a.$instance.set(function(){bMoor.iterate(c,function(a){a.check()})},30),this.$snapMO=b++,this.checking=!1,this.watching={},this.observe(d),this.start()},properties:{observe:function(a){this.model&&delete this.model.$observers[this.$snapMO],this.model=a,a.$observers||(a.$observers={}),a.$observers[this.$snapMO]=this},watch:function(a,b){var c,d;this.watching[a]||(c=a.split("."),this.watching[a]={path:c,value:this.evaluate(c),calls:[]}),d=this.watching[a],b(d.value,void 0),d.calls.push(b)},evaluate:function(a){var b,c,d=this.model;for(bMoor.isString(a)&&(a=a.split(".")),b=0,c=a.length;c>b&&void 0!==d;b++)d=d[a[b]];return d},check:function(){var a=this;this.checking=!0,bMoor.iterate(this.watching,function(b){var c,d,e=a.evaluate(b.path);if(e!==b.value){for(c=0,d=b.calls.length;d>c;c++)b.calls[c](e,b.value);b.value=e}}),this.checking=!1},start:function(){c[this.$snapMO]=this},stop:function(){delete c[this.$snapMO]}}}}]),bMoor.define("bmoor.core.Model",[function(){function a(c,d){var e,f,g;for(e in c)c.hasOwnProperty(e)&&(f=c[e],g=d[e],void 0===g?d[e]=f:angular.isArray(f)?(angular.isArray(g)||(g=d[e]=[]),b(f,g)):angular.isObject(f)?(angular.isObject(g)||(g=d[e]={}),a(f,g)):f!=g&&(d[e]=f));for(e in d)d.hasOwnProperty(e)&&void 0===c[e]&&delete d[e];return d}function b(c,d){var e,f,g,h;for(e=0,f=c.length;f>e;e++)g=c[e],h=d[e],void 0===h?d[e]=g:angular.isObject(g)?(angular.isObject(h)||(h=d[e]={}),a(g,h)):angular.isArray(g)?(anguar.isArray(h)||(h=d[e]=[]),b(g,h)):g!==h&&(d[e]=g);for(e=f,f=d.length;f>e;e++)d.pop()}return{_merge:function(c){return bMoor.isArray(c)?b(c,this):a(c,this),this},_validate:function(){return null},_inflate:function(a){return a},_deflate:function(){return this},_update:function(a){this._merge(a,this)},_simplify:function(){return this._deflate()},toJson:function(){return JSON.stringify(this._simplify())}}}]),bMoor.make("bmoor.core.Service",[function(){function a(a,c){var d,e;return c.success&&(d=function(){return c.success.apply(a,arguments)}),c.failure&&(e=function(){return c.failure.apply(a,arguments)}),function(){var f,g,h,i,j,k=arguments;return bMoor.isString(c)&&(c={url:c}),c.massage&&(k[k.length-1]=c.massage.apply(a,k)),(!c.validation||c.validation.apply(a,k))&&(h=bMoor.isFunction(c.url)?c.url.apply(a,k):c.url,c.cached&&b[h]?j=b[h]:(i=k[k.length-1],c.request?(j=new bmoor.defer.Basic,f=[c.request.call(a,i),200],f.$inject=!0,j.resolve(f),j=j.promise):(g=bMoor.get(c.http||"bmoor.comm.Http"),j=new g({url:h,headers:c.headers,method:c.type||"GET",responseType:c.responseType}).promise),c.cached&&(b[h]=j))),j.then(d,e)}}var b={};return{onMake:function(b){var c=this;bMoor.iterate(b.services,function(b,d){c.prototype[d]=a(c,b)})}}}]),bMoor.make("bmoor.core.SmartMapObserver",["@undefined","bmoor.core.MapObserver",function(a,b){function c(a,b){{var d;this.model}if(bMoor.isString(a))this.updates[a]=bMoor.set(a,b,this.model);else if(bMoor.isObject(a))for(d in a)a.hasOwnProperty(d)&&c.call(this,d,a[d])}function d(a){this.model;bMoor.isString(a)&&(this.updates[update]=bMoor.del(a,this.model))}return{parent:b,construct:function(){b.apply(this,arguments)},properties:{observe:function(a){var e=this;this.updates={},b.prototype.observe.call(this,a),a.$set=function(){c.apply(e,arguments)},a.$delete=function(){d.apply(e,arguments)}},check:function(){var a=this;bMoor.iterate(this.updates,function(b,c){var d,e,f,g=a.watching[c];if(g)for(f=a.evaluate(c),d=0,e=g.calls.length;e>d;d++)g.calls[d](f,b)}),this.updates={}}}}}]),bMoor.make("bmoor.error.Basic",["@undefined",function(a){return{parent:Error,construct:function(b,c,d){var e,f;try{throw new Error}catch(g){f=g}this.name=this.__class,this.error=b,this.fileName=c,this.lineNumber=d,this.problem=a,f.stack&&(e=f.stack.split("\n"),"Error"===e[0]?(e.shift(),e.shift(),e.shift()):(e.pop(),e.shift(),e.shift()),this.problem=e[0],this.stack=e.join("\n")),this.message=b+"\n"+this.stack},properties:{toString:function(){return this.name+": "+this.message}}}}]);